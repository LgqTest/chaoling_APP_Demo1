éå¸¸å¥½ï¼æˆ‘å·²ç»è·å–åˆ°æœ€æ–°çš„æŠ€æœ¯æ–‡æ¡£ã€‚ç°åœ¨è®©æˆ‘ä¸ºä½ æ•´ç†ä¸€ä»½**å®Œæ•´çš„PRDå¼€å‘æ–‡æ¡£**ï¼ŒåŒ…å«è¯¦ç»†çš„ä»£ç å®ç°è¯´æ˜ã€‚è¿™æ¬¡æˆ‘ä¼šéå¸¸è¯¦ç»†åœ°è®²è§£æ¯ä¸€ä¸ªæ¨¡å—çš„å®ç°æ–¹å¼ã€‚

---

# **UniApp AIè¯­éŸ³åŠ©æ‰‹å®Œæ•´å¼€å‘æ–‡æ¡£ (PRD)**

**é¡¹ç›®åç§°ï¼š** å¨ç”µæ™ºèƒ½å®¶å±…è¯­éŸ³åŠ©æ‰‹  
**å¼€å‘è€…ï¼š** ææ¡‚æ£‹ (AIé›†æˆä¸“å®¶Â·è½¯ä»¶å·¥ç¨‹å¸ˆ)  
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** 1.0  
**æœ€åæ›´æ–°ï¼š** 2026-02-03  
**æŠ€æœ¯æ ˆï¼š** UniApp + Vue 2 + HBuilderX + Android APK

---

## **ç¬¬ä¸€éƒ¨åˆ†ï¼šäº§å“æ¦‚è¿°**

### **1.1 äº§å“å®šä½**

è¿™æ˜¯ä¸€æ¬¾åŸºäºUniAppæ¡†æ¶å¼€å‘çš„**æç®€åŒ–Androidè¯­éŸ³AIåŠ©æ‰‹**ï¼Œä¸“æ³¨äºå¨ç”µåœºæ™¯çš„æ™ºèƒ½å®¶ç”µæ§åˆ¶ã€‚äº§å“é€šè¿‡é›†æˆç™¾åº¦è¯­éŸ³è¯†åˆ«ã€Moonshot AIå¯¹è¯æ¨¡å‹ï¼Œæ‰“é€ ä¸€ä¸ªè½»é‡çº§ã€å¿«é€ŸéªŒè¯çš„Demoåº”ç”¨ã€‚

**æ ¸å¿ƒä»·å€¼ä¸»å¼ ï¼š**
- å¿«é€ŸåŸå‹éªŒè¯ï¼ˆå¼€å‘å‘¨æœŸçŸ­ï¼‰
- ç•Œé¢ç®€æ´æ—¶å°šï¼ˆ5ä¸ªé¡µé¢è®¾è®¡ï¼‰
- è¯­éŸ³äº¤äº’è‡ªç„¶ï¼ˆç”¨æˆ·å‹å¥½ä½“éªŒï¼‰
- è·¨å¹³å°éƒ¨ç½²ä¾¿æ·ï¼ˆä¸€å¥—ä»£ç å¤šå¹³å°ï¼‰

### **1.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—**

ä½ çš„åº”ç”¨å°†åŒ…å«ä»¥ä¸‹äº”ä¸ªé¡µé¢å’Œæ ¸å¿ƒåŠŸèƒ½ï¼š

**é¡µé¢ç»“æ„ï¼š**
- é¦–é¡µï¼ˆHomeï¼‰ï¼šåº”ç”¨å…¥å£ã€å¿«é€Ÿæ“ä½œå¡ç‰‡
- èŠå¤©é¡µé¢ï¼ˆChatï¼‰ï¼šä¸­é—´æ ¸å¿ƒé¡µé¢ï¼Œè¯­éŸ³äº¤äº’ã€æ¶ˆæ¯å±•ç¤º
- æ§åˆ¶é¡µé¢ï¼ˆControlï¼‰ï¼šå®¶ç”µæ§åˆ¶é¢æ¿
- åœºæ™¯é¡µé¢ï¼ˆSceneï¼‰ï¼šæ™ºèƒ½åœºæ™¯è®¾ç½®
- æˆ‘çš„é¡µé¢ï¼ˆMineï¼‰ï¼šç”¨æˆ·ä¿¡æ¯ã€è®¾ç½®

**åŠŸèƒ½æ¸…å•ï¼š**
- âœ… å®æ—¶è¯­éŸ³å½•å…¥ï¼ˆéº¦å…‹é£æƒé™ç®¡ç†ï¼‰
- âœ… è¯­éŸ³è¯†åˆ«è½¬æ–‡å­—ï¼ˆç™¾åº¦APIï¼‰
- âœ… LLMæ™ºèƒ½å¯¹è¯ï¼ˆMoonshot APIï¼‰
- âœ… æ¶ˆæ¯åˆ—è¡¨å±•ç¤ºä¸æ»šåŠ¨
- âœ… ç•Œé¢UIå®Œæ•´å‘ˆç°
- âœ… Android APKæ‰“åŒ…éƒ¨ç½²

---

## **ç¬¬äºŒéƒ¨åˆ†ï¼šæŠ€æœ¯æ¶æ„è®¾è®¡**

### **2.1 æ•´ä½“æŠ€æœ¯æ ˆ**

| ç»„ä»¶ | æŠ€æœ¯é€‰å‹ | ç‰ˆæœ¬ | ç”¨é€” |
|-----|--------|------|-----|
| å‰ç«¯æ¡†æ¶ | Vue 2 | 2.7+ | æ¸è¿›å¼UIå¼€å‘ |
| è·¨å¹³å°æ¡†æ¶ | UniApp | 3.x | Android/iOSç¼–è¯‘ |
| å¼€å‘å·¥å…· | HBuilderX | æœ€æ–°ç‰ˆ | IDE + äº‘æ‰“åŒ… |
| çŠ¶æ€ç®¡ç† | Vuex | 3.x | å…¨å±€çŠ¶æ€å…±äº« |
| è¯­éŸ³è¯†åˆ« | ç™¾åº¦Speech API | v2.0 | éŸ³é¢‘è½¬æ–‡å­— |
| LLMå¯¹è¯ | Moonshot (Kimi) | K2.5 | æ™ºèƒ½å›å¤ç”Ÿæˆ |
| UIç»„ä»¶åº“ | uni-ui | æœ€æ–°ç‰ˆ | é¢„åˆ¶ç»„ä»¶ |
| æ‰“åŒ…å·¥å…· | HBuilderXäº‘æ‰“åŒ… | - | APKç”Ÿæˆ |

### **2.2 æ•°æ®æµç¨‹æ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç”¨æˆ·äº¤äº’æµç¨‹å›¾                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·UIäº¤äº’
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯­éŸ³å½•å…¥æ¨¡å— (RecorderManager)                        â”‚
â”‚    - æŒ‰ä½å½•éŸ³æŒ‰é’® â†’ å¼€å§‹å½•éŸ³                              â”‚
â”‚    - æ¾å¼€æŒ‰é’® â†’ åœæ­¢å½•éŸ³ â†’ è·å–æœ¬åœ°éŸ³é¢‘æ–‡ä»¶è·¯å¾„           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. éŸ³é¢‘å¤„ç†æ¨¡å— (AudioProcessor)                         â”‚
â”‚    - è¯»å–éŸ³é¢‘æ–‡ä»¶ (WAV/M4Aæ ¼å¼)                          â”‚
â”‚    - Base64ç¼–ç å¤„ç†                                      â”‚
â”‚    - æ–‡ä»¶å¤§å°éªŒè¯ (éœ€<4M)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç™¾åº¦è¯­éŸ³APIæœåŠ¡ (BaiduSpeech)                        â”‚
â”‚    POST: https://aip.baidubce.com/rest/2.0/speech/      â”‚
â”‚          u/v1/recognize                                 â”‚
â”‚    è¯·æ±‚ä½“: {speech: base64Data, len: fileSize, rate: 16000}
â”‚    è¿”å›: {result: ["è¯†åˆ«æ–‡æœ¬"], err_no: 0}              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† (ContextManager)                       â”‚
â”‚    - ä¿å­˜è¯†åˆ«çš„ç”¨æˆ·æ–‡æœ¬                                  â”‚
â”‚    - æ„å»ºæ¶ˆæ¯å†å²æ•°ç»„                                    â”‚
â”‚    - ç»´æŠ¤å¯¹è¯ä¸Šä¸‹æ–‡ (æœ€è¿‘20æ¡)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Moonshot APIæœåŠ¡ (MoonshotAPI)                       â”‚
â”‚    POST: https://api.moonshot.cn/v1/chat/completions   â”‚
â”‚    è¯·æ±‚ä½“: {model: "moonshot-v1-8k", messages: [...]}  â”‚
â”‚    è¿”å›: {choices: [{message: {content: "å›å¤æ–‡æœ¬"}}]}  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. UIæ›´æ–°æ¨¡å— (MessageDisplay)                          â”‚
â”‚    - æ·»åŠ AIå›å¤æ¶ˆæ¯åˆ°åˆ—è¡¨                                â”‚
â”‚    - è§¦å‘è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨                                  â”‚
â”‚    - æ›´æ–°é¡µé¢è§†å›¾                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. æ¶ˆæ¯å­˜å‚¨ (LocalStorage)                              â”‚
â”‚    - ä¿å­˜å¯¹è¯è®°å½•åˆ°æœ¬åœ°ç¼“å­˜                              â”‚
â”‚    - æ”¯æŒèŠå¤©å†å²æ¢å¤                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **2.3 æ¨¡å—èŒè´£åˆ’åˆ†**

- **å½•éŸ³æ¨¡å—ï¼š** è´Ÿè´£æ‰‹æœºéº¦å…‹é£æƒé™ç”³è¯·ã€å½•éŸ³å¯åŠ¨/åœæ­¢ã€éŸ³é¢‘æ–‡ä»¶ç”Ÿæˆ
- **éŸ³é¢‘å¤„ç†æ¨¡å—ï¼š** è´Ÿè´£Base64ç¼–ç ã€æ–‡ä»¶æ ¡éªŒã€æ ¼å¼è½¬æ¢
- **APIé€‚é…æ¨¡å—ï¼š** è´Ÿè´£ç™¾åº¦APIä¸Moonshot APIçš„è¯·æ±‚/å“åº”å¤„ç†
- **çŠ¶æ€ç®¡ç†æ¨¡å—ï¼š** è´Ÿè´£å…¨å±€æ¶ˆæ¯åˆ—è¡¨ã€åŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†
- **UIå±•ç¤ºæ¨¡å—ï¼š** è´Ÿè´£æ¶ˆæ¯æ°”æ³¡ã€è¾“å…¥æ¡†ã€æ»šåŠ¨ã€åŠ¨ç”»æ•ˆæœ
- **å­˜å‚¨æ¨¡å—ï¼š** è´Ÿè´£å¯¹è¯å†å²ã€ç”¨æˆ·è®¾ç½®ã€ç¼“å­˜ç®¡ç†

---

## **ç¬¬ä¸‰éƒ¨åˆ†ï¼šé¡¹ç›®ç›®å½•ç»“æ„**

```
ai-voice-assistant/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/               # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ MessageBubble.vue     # æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ RecordButton.vue      # å½•éŸ³æŒ‰é’®ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ InputBox.vue          # è¾“å…¥æ¡†ç»„ä»¶
â”‚   â”‚   â””â”€â”€ Loading.vue           # åŠ è½½åŠ¨ç”»ç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/                    # é¡µé¢ç›®å½•
â”‚   â”‚   â”œâ”€â”€ index/
â”‚   â”‚   â”‚   â””â”€â”€ index.vue         # é¦–é¡µ
â”‚   â”‚   â”œâ”€â”€ chat/
â”‚   â”‚   â”‚   â””â”€â”€ chat.vue          # èŠå¤©é¡µé¢ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ control/
â”‚   â”‚   â”‚   â””â”€â”€ control.vue       # å®¶ç”µæ§åˆ¶é¡µé¢
â”‚   â”‚   â”œâ”€â”€ scene/
â”‚   â”‚   â”‚   â””â”€â”€ scene.vue         # åœºæ™¯è®¾ç½®é¡µé¢
â”‚   â”‚   â””â”€â”€ mine/
â”‚   â”‚       â””â”€â”€ mine.vue          # æˆ‘çš„é¡µé¢
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                    # VuexçŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ index.js              # å…¨å±€çŠ¶æ€
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.js            # HTTPè¯·æ±‚å·¥å…·
â”‚   â”‚   â”œâ”€â”€ audio.js              # éŸ³é¢‘å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ baidu-speech.js       # ç™¾åº¦è¯­éŸ³API
â”‚   â”‚   â”œâ”€â”€ moonshot-api.js       # Moonshot API
â”‚   â”‚   â”œâ”€â”€ storage.js            # æœ¬åœ°å­˜å‚¨å·¥å…·
â”‚   â”‚   â””â”€â”€ logger.js             # æ—¥å¿—å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                   # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ icons/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                   # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ main.js                   # å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ manifest.json             # åº”ç”¨é…ç½®
â”‚
â”œâ”€â”€ package.json                  # ä¾èµ–é…ç½®
â”œâ”€â”€ uni.scss                      # å…¨å±€æ ·å¼
â””â”€â”€ README.md                     # é¡¹ç›®æ–‡æ¡£
```

---

## **ç¬¬å››éƒ¨åˆ†ï¼šæ ¸å¿ƒä»£ç å®ç°**

### **4.1 é¡¹ç›®åˆå§‹åŒ–ä¸é…ç½®**

#### **4.1.1 package.json ä¾èµ–é…ç½®**

```json
{
  "name": "ai-voice-assistant",
  "version": "1.0.0",
  "description": "AIè¯­éŸ³åŠ©æ‰‹ - UniAppç‰ˆæœ¬",
  "main": "main.js",
  "scripts": {
    "dev": "uni",
    "build": "uni build",
    "build:app": "uni build --platform app"
  },
  "dependencies": {
    "vue": "^2.7.14",
    "uni-ui": "^1.4.24"
  },
  "devDependencies": {
    "@dcloudio/uni-app": "^3.0.0-alpha",
    "@dcloudio/uni-cli": "^3.0.0-alpha",
    "@dcloudio/uni-ui": "^1.4.24"
  }
}
```

#### **4.1.2 manifest.json åº”ç”¨æ¸…å•**

```json
{
  "name": "AIè¯­éŸ³åŠ©æ‰‹",
  "appid": "__UNI__YOUR_APP_ID__",
  "description": "å¨ç”µåœºæ™¯æ™ºèƒ½å®¶å±…æ§åˆ¶åŠ©æ‰‹",
  "versionName": "1.0.0",
  "versionCode": 1,
  "transformPx": false,
  "app-plus": {
    "usingComponents": true,
    "splashscreen": {
      "alwaysShowBeforeRender": true,
      "waiting": true,
      "autoclose": true,
      "delay": 0
    },
    "modules": {},
    "permissions": [
      "INTERNET",
      "RECORD_AUDIO",
      "WRITE_EXTERNAL_STORAGE",
      "READ_EXTERNAL_STORAGE",
      "MODIFY_AUDIO_SETTINGS"
    ]
  },
  "permissions": {
    "android": [
      "android.permission.INTERNET",
      "android.permission.RECORD_AUDIO",
      "android.permission.WRITE_EXTERNAL_STORAGE",
      "android.permission.READ_EXTERNAL_STORAGE",
      "android.permission.MODIFY_AUDIO_SETTINGS"
    ]
  }
}
```

### **4.2 Vuex å…¨å±€çŠ¶æ€ç®¡ç†**

#### **store/index.js**

```javascript
import Vue from 'vue'
import Vuex from 'vuex'

Vue.use(Vuex)

export default new Vuex.Store({
  state: {
    // æ¶ˆæ¯åˆ—è¡¨
    messages: [],
    
    // å½•éŸ³çŠ¶æ€
    isRecording: false,
    recordingTime: 0,
    
    // åŠ è½½çŠ¶æ€
    isLoading: false,
    loadingText: '',
    
    // APIå¯†é’¥é…ç½®
    apiConfig: {
      baiduApiKey: 'YOUR_BAIDU_API_KEY',
      baiduSecretKey: 'YOUR_BAIDU_SECRET_KEY',
      moonshotApiKey: 'YOUR_MOONSHOT_API_KEY'
    },
    
    // å¯¹è¯ä¸Šä¸‹æ–‡
    conversationContext: [],
    maxContextLength: 20
  },
  
  mutations: {
    // æ·»åŠ æ¶ˆæ¯
    ADD_MESSAGE(state, message) {
      state.messages.push({
        id: Date.now(),
        content: message.content,
        role: message.role, // 'user' æˆ– 'assistant'
        timestamp: new Date().getTime(),
        status: message.status || 'success' // 'success', 'error', 'sending'
      })
    },
    
    // æ›´æ–°æ¶ˆæ¯çŠ¶æ€
    UPDATE_MESSAGE_STATUS(state, { messageId, status }) {
      const msg = state.messages.find(m => m.id === messageId)
      if (msg) {
        msg.status = status
      }
    },
    
    // æ¸…ç©ºæ¶ˆæ¯åˆ—è¡¨
    CLEAR_MESSAGES(state) {
      state.messages = []
    },
    
    // è®¾ç½®å½•éŸ³çŠ¶æ€
    SET_RECORDING(state, isRecording) {
      state.isRecording = isRecording
    },
    
    // æ›´æ–°å½•éŸ³æ—¶é•¿
    UPDATE_RECORDING_TIME(state, time) {
      state.recordingTime = time
    },
    
    // è®¾ç½®åŠ è½½çŠ¶æ€
    SET_LOADING(state, { isLoading, loadingText = '' }) {
      state.isLoading = isLoading
      state.loadingText = loadingText
    },
    
    // æ›´æ–°å¯¹è¯ä¸Šä¸‹æ–‡
    UPDATE_CONTEXT(state, { role, content }) {
      state.conversationContext.push({ role, content })
      // åªä¿ç•™æœ€è¿‘20æ¡æ¶ˆæ¯
      if (state.conversationContext.length > state.maxContextLength) {
        state.conversationContext = state.conversationContext.slice(-state.maxContextLength)
      }
    },
    
    // æ¸…ç©ºä¸Šä¸‹æ–‡
    CLEAR_CONTEXT(state) {
      state.conversationContext = []
    }
  },
  
  actions: {
    // å‘é€ç”¨æˆ·æ¶ˆæ¯
    sendUserMessage({ commit }, content) {
      commit('ADD_MESSAGE', {
        content: content,
        role: 'user'
      })
      commit('UPDATE_CONTEXT', {
        role: 'user',
        content: content
      })
    },
    
    // å‘é€AIå›å¤
    sendAIMessage({ commit }, content) {
      commit('ADD_MESSAGE', {
        content: content,
        role: 'assistant'
      })
      commit('UPDATE_CONTEXT', {
        role: 'assistant',
        content: content
      })
    },
    
    // è®¾ç½®åŠ è½½çŠ¶æ€
    setLoading({ commit }, { isLoading, loadingText }) {
      commit('SET_LOADING', { isLoading, loadingText })
    }
  },
  
  getters: {
    // è·å–æœ€åä¸€æ¡æ¶ˆæ¯
    lastMessage: state => state.messages[state.messages.length - 1],
    
    // è·å–æ¶ˆæ¯æ€»æ•°
    messageCount: state => state.messages.length,
    
    // è·å–å¯¹è¯ä¸Šä¸‹æ–‡æ•°ç»„
    contextArray: state => state.conversationContext
  }
})
```

### **4.3 æ ¸å¿ƒä¸šåŠ¡æ¨¡å—å®ç°**

#### **4.3.1 ç™¾åº¦è¯­éŸ³è¯†åˆ«å·¥å…· (utils/baidu-speech.js)**

```javascript
// ç™¾åº¦è¯­éŸ³è¯†åˆ«APIå·¥å…·ç±»
class BaiduSpeechService {
  constructor(apiKey, secretKey) {
    this.apiKey = apiKey
    this.secretKey = secretKey
    this.accessToken = null
    this.tokenExpireTime = 0
  }
  
  // è·å–Access Token
  async getAccessToken() {
    const now = Date.now()
    
    // Tokenè¿˜æœ‰æ•ˆæœŸè¶…è¿‡5åˆ†é’Ÿåˆ™å¤ç”¨
    if (this.accessToken && this.tokenExpireTime - now > 300000) {
      return this.accessToken
    }
    
    try {
      const tokenUrl = `https://aip.baidubce.com/oauth/2.0/token`
      
      const response = await uni.request({
        url: tokenUrl,
        method: 'POST',
        header: {
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        data: {
          grant_type: 'client_credentials',
          client_id: this.apiKey,
          client_secret: this.secretKey
        }
      })
      
      if (response[1].statusCode === 200) {
        const data = response[1].data
        this.accessToken = data.access_token
        // Tokenè¿‡æœŸæ—¶é—´ = å½“å‰æ—¶é—´ + æœ‰æ•ˆæœŸ(ç§’) - æå‰åˆ·æ–°5åˆ†é’Ÿ
        this.tokenExpireTime = now + (data.expires_in * 1000) - 300000
        return this.accessToken
      } else {
        throw new Error('è·å–Tokenå¤±è´¥: ' + response[1].statusCode)
      }
    } catch (error) {
      console.error('è·å–ç™¾åº¦Access Tokenå¤±è´¥:', error)
      throw error
    }
  }
  
  // è¯†åˆ«è¯­éŸ³æ–‡ä»¶
  async recognizeAudio(audioFilePath) {
    try {
      // ç¬¬ä¸€æ­¥ï¼šè·å–Access Token
      const token = await this.getAccessToken()
      
      // ç¬¬äºŒæ­¥ï¼šè¯»å–éŸ³é¢‘æ–‡ä»¶å¹¶è½¬Base64
      const audioBase64 = await this.readAndEncodeAudio(audioFilePath)
      
      // ç¬¬ä¸‰æ­¥ï¼šè°ƒç”¨ç™¾åº¦API
      const recognizeUrl = `https://aip.baidubce.com/rest/2.0/speech/u/v1/recognize?access_token=${token}`
      
      const response = await uni.request({
        url: recognizeUrl,
        method: 'POST',
        header: {
          'Content-Type': 'application/json'
        },
        data: {
          format: 'wav',
          rate: 16000,
          speech: audioBase64,
          len: audioBase64.length,
          channel: 1
        }
      })
      
      if (response[1].statusCode === 200) {
        const data = response[1].data
        
        if (data.err_no === 0 && data.result && data.result.length > 0) {
          return {
            success: true,
            text: data.result[0]
          }
        } else {
          return {
            success: false,
            error: data.err_msg || 'è¯†åˆ«å¤±è´¥'
          }
        }
      } else {
        throw new Error('APIè°ƒç”¨å¤±è´¥: ' + response[1].statusCode)
      }
    } catch (error) {
      console.error('è¯­éŸ³è¯†åˆ«å¤±è´¥:', error)
      return {
        success: false,
        error: error.message
      }
    }
  }
  
  // è¯»å–æ–‡ä»¶å¹¶è½¬Base64
  async readAndEncodeAudio(filePath) {
    return new Promise((resolve, reject) => {
      uni.getFileInfo({
        filePath: filePath,
        success: (res) => {
          // è·å–æ–‡ä»¶å¤§å°
          const fileSize = res.size
          
          if (fileSize > 4 * 1024 * 1024) {
            reject(new Error('éŸ³é¢‘æ–‡ä»¶è¿‡å¤§ï¼Œä¸è¶…è¿‡4M'))
            return
          }
          
          // ä½¿ç”¨plus.ioè¯»å–æ–‡ä»¶
          if (typeof plus !== 'undefined') {
            plus.io.resolveLocalFileSystemURL(filePath, (entry) => {
              entry.file((file) => {
                const reader = new plus.io.FileReader()
                reader.onloadend = (event) => {
                  // è½¬ä¸ºBase64
                  const base64Data = plus.base64.encode(event.target.result)
                  resolve(base64Data)
                }
                reader.readAsArrayBuffer(file)
              })
            }, (error) => {
              reject(new Error('æ–‡ä»¶è¯»å–å¤±è´¥: ' + error.message))
            })
          } else {
            reject(new Error('ä¸æ”¯æŒçš„å¹³å°'))
          }
        },
        fail: (error) => {
          reject(new Error('æ–‡ä»¶ä¿¡æ¯è·å–å¤±è´¥: ' + error.message))
        }
      })
    })
  }
}

export default BaiduSpeechService
```

#### **4.3.2 Moonshot APIå¯¹è¯å·¥å…· (utils/moonshot-api.js)**

```javascript
// Moonshot (Kimi) APIå·¥å…·ç±» - å®Œå…¨å…¼å®¹OpenAIæ ¼å¼
class MoonshotAPIService {
  constructor(apiKey) {
    this.apiKey = apiKey
    this.baseUrl = 'https://api.moonshot.cn/v1'
    this.model = 'moonshot-v1-8k' // æ”¯æŒ8kä¸Šä¸‹æ–‡
  }
  
  // åˆ›å»ºèŠå¤©å®Œæˆè¯·æ±‚
  async createChatCompletion(messages, options = {}) {
    try {
      const payload = {
        model: options.model || this.model,
        messages: messages,
        temperature: options.temperature || 0.7,
        top_p: options.top_p || 0.95,
        max_tokens: options.max_tokens || 1024
      }
      
      const response = await uni.request({
        url: `${this.baseUrl}/chat/completions`,
        method: 'POST',
        header: {
          'Authorization': `Bearer ${this.apiKey}`,
          'Content-Type': 'application/json'
        },
        data: payload
      })
      
      if (response[1].statusCode === 200) {
        const data = response[1].data
        
        if (data.choices && data.choices.length > 0) {
          return {
            success: true,
            content: data.choices[0].message.content,
            usage: data.usage
          }
        } else {
          return {
            success: false,
            error: 'æœªè·å–åˆ°æœ‰æ•ˆå›å¤'
          }
        }
      } else if (response[1].statusCode === 401) {
        return {
          success: false,
          error: 'APIå¯†é’¥æ— æ•ˆæˆ–å·²è¿‡æœŸ'
        }
      } else {
        return {
          success: false,
          error: `APIè°ƒç”¨å¤±è´¥: ${response[1].statusCode}`
        }
      }
    } catch (error) {
      console.error('Moonshot APIè°ƒç”¨å¤±è´¥:', error)
      return {
        success: false,
        error: error.message
      }
    }
  }
  
  // ä¾¿åˆ©æ–¹æ³•ï¼šå‘é€å•æ¡æ¶ˆæ¯å¹¶è·å–å›å¤
  async sendMessage(userMessage, conversationContext = []) {
    // æ„å»ºæ¶ˆæ¯æ•°ç»„ï¼ˆåŒ…å«å†å²ä¸Šä¸‹æ–‡ï¼‰
    const messages = [
      ...conversationContext,
      {
        role: 'user',
        content: userMessage
      }
    ]
    
    return await this.createChatCompletion(messages)
  }
  
  // ç³»ç»Ÿæç¤ºè¯è®¾ç½®
  setSystemPrompt(systemPrompt) {
    this.systemPrompt = systemPrompt
  }
  
  // è·å–å¸¦ç³»ç»Ÿæç¤ºè¯çš„æ¶ˆæ¯æ•°ç»„
  buildMessagesWithSystem(messages) {
    if (!this.systemPrompt) {
      return messages
    }
    
    return [
      {
        role: 'system',
        content: this.systemPrompt
      },
      ...messages
    ]
  }
}

export default MoonshotAPIService
```

#### **4.3.3 éŸ³é¢‘å¤„ç†å·¥å…· (utils/audio.js)**

```javascript
// éŸ³é¢‘å¤„ç†å·¥å…·ç±»
class AudioRecorder {
  constructor() {
    this.recorder = null
    this.recordingPath = null
    this.isRecording = false
  }
  
  // åˆå§‹åŒ–å½•éŸ³
  init() {
    return new Promise((resolve, reject) => {
      // æ£€æŸ¥å¹³å°æ”¯æŒ
      if (typeof plus !== 'undefined' && plus.media) {
        this.recorder = plus.media.getMediaRecorder()
        resolve()
      } else {
        reject(new Error('å¹³å°ä¸æ”¯æŒå½•éŸ³'))
      }
    })
  }
  
  // å¼€å§‹å½•éŸ³
  startRecording() {
    return new Promise((resolve, reject) => {
      try {
        if (!this.recorder) {
          reject(new Error('å½•éŸ³å™¨æœªåˆå§‹åŒ–'))
          return
        }
        
        // è®¾ç½®å½•éŸ³æ–‡ä»¶è·¯å¾„
        const recordDir = plus.io.convertLocalFileSystemURL(
          '_doc/audio/'
        )
        this.recordingPath = recordDir + `recording_${Date.now()}.wav`
        
        // å¼€å§‹å½•éŸ³
        this.recorder.startRecord({
          filename: this.recordingPath,
          format: 'wav',
          channels: 1,
          samplerate: 16000,
          success: () => {
            this.isRecording = true
            console.log('å¼€å§‹å½•éŸ³:', this.recordingPath)
            resolve(this.recordingPath)
          },
          error: (error) => {
            reject(new Error('å¼€å§‹å½•éŸ³å¤±è´¥: ' + error))
          }
        })
      } catch (error) {
        reject(error)
      }
    })
  }
  
  // åœæ­¢å½•éŸ³
  stopRecording() {
    return new Promise((resolve, reject) => {
      try {
        if (!this.recorder || !this.isRecording) {
          reject(new Error('æœªåœ¨å½•éŸ³çŠ¶æ€'))
          return
        }
        
        this.recorder.stopRecord({
          success: () => {
            this.isRecording = false
            console.log('åœæ­¢å½•éŸ³')
            resolve(this.recordingPath)
          },
          error: (error) => {
            reject(new Error('åœæ­¢å½•éŸ³å¤±è´¥: ' + error))
          }
        })
      } catch (error) {
        reject(error)
      }
    })
  }
  
  // è·å–å½•éŸ³æ–‡ä»¶è·¯å¾„
  getRecordingPath() {
    return this.recordingPath
  }
  
  // åˆ é™¤å½•éŸ³æ–‡ä»¶
  deleteRecording(filePath) {
    return new Promise((resolve, reject) => {
      plus.io.resolveLocalFileSystemURL(filePath, (entry) => {
        entry.remove(() => {
          resolve()
        }, (error) => {
          reject(error)
        })
      }, (error) => {
        reject(error)
      })
    })
  }
}

export default AudioRecorder
```

### **4.4 é¡µé¢å®ç°**

#### **4.4.1 èŠå¤©é¡µé¢ - chat.vueï¼ˆæ ¸å¿ƒï¼‰**

```vue
<template>
  <view class="chat-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <view class="header">
      <text class="header-title">AIè¯­éŸ³åŠ©æ‰‹</text>
      <text class="header-subtitle">å¨ç”µæ™ºèƒ½æ§åˆ¶</text>
    </view>
    
    <!-- æ¶ˆæ¯å±•ç¤ºåŒº -->
    <scroll-view 
      class="message-list"
      scroll-y
      :scroll-top="scrollTop"
      @scroll="onScroll"
    >
      <!-- æ¬¢è¿æ¶ˆæ¯ -->
      <view v-if="messages.length === 0" class="welcome-box">
        <text class="welcome-icon">ğŸ¤–</text>
        <text class="welcome-text">ä½ å¥½ï¼Œæˆ‘æ˜¯AIè¯­éŸ³åŠ©æ‰‹</text>
        <text class="welcome-subtitle">ç‚¹å‡»ä¸‹æ–¹éº¦å…‹é£å¼€å§‹äº¤äº’</text>
      </view>
      
      <!-- æ¶ˆæ¯æ°”æ³¡åˆ—è¡¨ -->
      <view v-for="msg in messages" :key="msg.id" class="message-item">
        <message-bubble
          :content="msg.content"
          :role="msg.role"
          :status="msg.status"
          :timestamp="msg.timestamp"
        />
      </view>
      
      <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
      <view v-if="isLoading" class="loading-box">
        <loading :text="loadingText" />
      </view>
    </scroll-view>
    
    <!-- è¾“å…¥åŒºåŸŸ -->
    <view class="input-area">
      <!-- æ–‡æœ¬è¾“å…¥æ¡† -->
      <input-box
        :value="inputText"
        @input="onInputChange"
        @send="sendTextMessage"
        :disabled="isRecording || isLoading"
      />
      
      <!-- å½•éŸ³æŒ‰é’® -->
      <record-button
        :isRecording="isRecording"
        :recordingTime="recordingTime"
        @start="startRecording"
        @stop="stopRecording"
        @cancel="cancelRecording"
      />
    </view>
  </view>
</template>

<script>
import { mapState, mapActions, mapMutations } from 'vuex'
import MessageBubble from '@/components/MessageBubble.vue'
import RecordButton from '@/components/RecordButton.vue'
import InputBox from '@/components/InputBox.vue'
import Loading from '@/components/Loading.vue'
import AudioRecorder from '@/utils/audio'
import BaiduSpeechService from '@/utils/baidu-speech'
import MoonshotAPIService from '@/utils/moonshot-api'

export default {
  name: 'ChatPage',
  components: {
    MessageBubble,
    RecordButton,
    InputBox,
    Loading
  },
  data() {
    return {
      inputText: '',
      scrollTop: 0,
      recordingTimer: null,
      recordingInterval: null,
      
      // ä¸šåŠ¡å®ä¾‹
      audioRecorder: null,
      baiduService: null,
      moonshotService: null
    }
  },
  computed: {
    ...mapState([
      'messages',
      'isRecording',
      'recordingTime',
      'isLoading',
      'loadingText',
      'apiConfig',
      'conversationContext'
    ])
  },
  methods: {
    ...mapActions([
      'sendUserMessage',
      'sendAIMessage',
      'setLoading'
    ]),
    ...mapMutations([
      'SET_RECORDING',
      'UPDATE_RECORDING_TIME',
      'ADD_MESSAGE',
      'SET_LOADING'
    ]),
    
    // åˆå§‹åŒ–é¡µé¢
    async initPage() {
      try {
        // åˆå§‹åŒ–éŸ³é¢‘å½•åˆ¶å™¨
        this.audioRecorder = new AudioRecorder()
        await this.audioRecorder.init()
        
        // åˆå§‹åŒ–ç™¾åº¦è¯­éŸ³æœåŠ¡
        this.baiduService = new BaiduSpeechService(
          this.apiConfig.baiduApiKey,
          this.apiConfig.baiduSecretKey
        )
        
        // åˆå§‹åŒ–MoonshotæœåŠ¡
        this.moonshotService = new MoonshotAPIService(
          this.apiConfig.moonshotApiKey
        )
        
        // è®¾ç½®ç³»ç»Ÿæç¤ºè¯
        this.moonshotService.setSystemPrompt(
          `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å¨ç”µæ™ºèƒ½åŠ©æ‰‹ã€‚
           ä½ éœ€è¦å¸®åŠ©ç”¨æˆ·æ§åˆ¶å’Œç®¡ç†å¨æˆ¿ç”µå™¨ã€‚
           ä¿æŒå¯¹è¯ç®€æ´ã€å‹å¥½ã€æœ‰å¸®åŠ©ã€‚
           å¦‚æœç”¨æˆ·é—®é¢˜ä¸å¨ç”µæ— å…³ï¼Œè¯·ç¤¼è²Œåœ°å¼•å¯¼å›å¨ç”µè¯é¢˜ã€‚`
        )
        
        console.log('èŠå¤©é¡µé¢åˆå§‹åŒ–å®Œæˆ')
      } catch (error) {
        console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error)
        uni.showToast({
          title: 'åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·é‡æ–°è¿›å…¥é¡µé¢',
          icon: 'none'
        })
      }
    },
    
    // å¼€å§‹å½•éŸ³
    async startRecording() {
      try {
        this.SET_RECORDING(true)
        await this.audioRecorder.startRecording()
        
        // å¯åŠ¨è®¡æ—¶å™¨
        let seconds = 0
        this.recordingInterval = setInterval(() => {
          seconds++
          this.UPDATE_RECORDING_TIME(seconds)
          
          // é™åˆ¶æœ€é•¿å½•éŸ³æ—¶é—´ä¸º60ç§’
          if (seconds >= 60) {
            this.stopRecording()
          }
        }, 1000)
      } catch (error) {
        console.error('å¯åŠ¨å½•éŸ³å¤±è´¥:', error)
        this.SET_RECORDING(false)
        uni.showToast({
          title: error.message,
          icon: 'none'
        })
      }
    },
    
    // åœæ­¢å½•éŸ³å¹¶å¤„ç†
    async stopRecording() {
      try {
        if (this.recordingInterval) {
          clearInterval(this.recordingInterval)
          this.recordingInterval = null
        }
        
        const recordingPath = await this.audioRecorder.stopRecording()
        this.SET_RECORDING(false)
        this.UPDATE_RECORDING_TIME(0)
        
        // å¤„ç†éŸ³é¢‘
        await this.processAudio(recordingPath)
      } catch (error) {
        console.error('åœæ­¢å½•éŸ³å¤±è´¥:', error)
        this.SET_RECORDING(false)
        uni.showToast({
          title: error.message,
          icon: 'none'
        })
      }
    },
    
    // å–æ¶ˆå½•éŸ³
    cancelRecording() {
      if (this.recordingInterval) {
        clearInterval(this.recordingInterval)
        this.recordingInterval = null
      }
      
      this.SET_RECORDING(false)
      this.UPDATE_RECORDING_TIME(0)
      
      // åˆ é™¤æœªå¤„ç†çš„å½•éŸ³æ–‡ä»¶
      if (this.audioRecorder && this.audioRecorder.recordingPath) {
        this.audioRecorder.deleteRecording(
          this.audioRecorder.recordingPath
        ).catch(err => console.error(err))
      }
    },
    
    // å¤„ç†éŸ³é¢‘æ–‡ä»¶
    async processAudio(audioPath) {
      try {
        this.SET_LOADING({
          isLoading: true,
          loadingText: 'æ­£åœ¨è¯†åˆ«è¯­éŸ³...'
        })
        
        // æ­¥éª¤1ï¼šè°ƒç”¨ç™¾åº¦è¯­éŸ³è¯†åˆ«API
        const speechResult = await this.baiduService.recognizeAudio(audioPath)
        
        if (!speechResult.success) {
          throw new Error('è¯­éŸ³è¯†åˆ«å¤±è´¥: ' + speechResult.error)
        }
        
        const recognizedText = speechResult.text
        console.log('è¯†åˆ«ç»“æœ:', recognizedText)
        
        // æ­¥éª¤2ï¼šæ·»åŠ ç”¨æˆ·æ¶ˆæ¯åˆ°ç•Œé¢å’Œä¸Šä¸‹æ–‡
        this.sendUserMessage(recognizedText)
        this.scrollToBottom()
        
        // æ­¥éª¤3ï¼šè°ƒç”¨Moonshot APIè·å–AIå›å¤
        this.SET_LOADING({
          isLoading: true,
          loadingText: 'AIæ€è€ƒä¸­...'
        })
        
        const aiResult = await this.moonshotService.sendMessage(
          recognizedText,
          this.conversationContext.slice(-18) // åªä¼ å‰é¢çš„æ¶ˆæ¯ï¼Œè¿™ä¸ªæ˜¯æœ€æ–°çš„ç”¨æˆ·æ¶ˆæ¯
        )
        
        if (!aiResult.success) {
          throw new Error('è·å–AIå›å¤å¤±è´¥: ' + aiResult.error)
        }
        
        // æ­¥éª¤4ï¼šæ·»åŠ AIå›å¤åˆ°ç•Œé¢
        this.sendAIMessage(aiResult.content)
        this.scrollToBottom()
        
        this.SET_LOADING({
          isLoading: false,
          loadingText: ''
        })
      } catch (error) {
        console.error('éŸ³é¢‘å¤„ç†å¤±è´¥:', error)
        
        this.SET_LOADING({
          isLoading: false,
          loadingText: ''
        })
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        this.ADD_MESSAGE({
          content: `å‡ºé”™: ${error.message}`,
          role: 'assistant',
          status: 'error'
        })
        
        uni.showToast({
          title: error.message,
          icon: 'none'
        })
      } finally {
        // åˆ é™¤ä¸´æ—¶å½•éŸ³æ–‡ä»¶
        if (this.audioRecorder && audioPath) {
          this.audioRecorder.deleteRecording(audioPath).catch(
            err => console.warn('åˆ é™¤ä¸´æ—¶æ–‡ä»¶å¤±è´¥:', err)
          )
        }
      }
    },
    
    // æ–‡æœ¬æ¶ˆæ¯å‘é€
    async sendTextMessage() {
      if (!this.inputText.trim()) {
        return
      }
      
      try {
        const userText = this.inputText.trim()
        this.inputText = ''
        
        // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
        this.sendUserMessage(userText)
        this.scrollToBottom()
        
        // è°ƒç”¨AIè·å–å›å¤
        this.SET_LOADING({
          isLoading: true,
          loadingText: 'AIæ€è€ƒä¸­...'
        })
        
        const aiResult = await this.moonshotService.sendMessage(
          userText,
          this.conversationContext.slice(-18)
        )
        
        if (!aiResult.success) {
          throw new Error(aiResult.error)
        }
        
        this.sendAIMessage(aiResult.content)
        this.scrollToBottom()
        
        this.SET_LOADING({
          isLoading: false,
          loadingText: ''
        })
      } catch (error) {
        console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error)
        this.SET_LOADING({
          isLoading: false,
          loadingText: ''
        })
        
        this.ADD_MESSAGE({
          content: `å‡ºé”™: ${error.message}`,
          role: 'assistant',
          status: 'error'
        })
      }
    },
    
    // æ–‡æœ¬è¾“å…¥å˜åŒ–
    onInputChange(value) {
      this.inputText = value
    },
    
    // æ»šåŠ¨äº‹ä»¶
    onScroll(event) {
      // å¯ä»¥åœ¨è¿™é‡Œå¤„ç†æ»šåŠ¨ç›¸å…³é€»è¾‘
    },
    
    // æ»šåŠ¨åˆ°åº•éƒ¨
    scrollToBottom() {
      this.$nextTick(() => {
        this.scrollTop = 99999
      })
    }
  },
  
  onLoad() {
    this.initPage()
  },
  
  onUnload() {
    // æ¸…ç†èµ„æº
    if (this.recordingInterval) {
      clearInterval(this.recordingInterval)
    }
  }
}
</script>

<style scoped lang="scss">
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.header {
  padding: 20px 15px;
  background: rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
  color: white;
  text-align: center;
}

.header-title {
  font-size: 22px;
  font-weight: bold;
  display: block;
}

.header-subtitle {
  font-size: 12px;
  opacity: 0.8;
  display: block;
  margin-top: 5px;
}

.message-list {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  background: rgba(255, 255, 255, 0.05);
}

.welcome-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: white;
  text-align: center;
}

.welcome-icon {
  font-size: 60px;
  margin-bottom: 20px;
}

.welcome-text {
  font-size: 18px;
  font-weight: bold;
  margin-bottom: 10px;
}

.welcome-subtitle {
  font-size: 14px;
  opacity: 0.7;
}

.message-item {
  margin-bottom: 15px;
  animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.loading-box {
  display: flex;
  justify-content: center;
  padding: 20px;
  margin-top: 20px;
}

.input-area {
  display: flex;
  gap: 10px;
  padding: 12px;
  background: rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(10px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
}
</style>
```

#### **4.4.2 æ¶ˆæ¯æ°”æ³¡ç»„ä»¶ - MessageBubble.vue**

```vue
<template>
  <view class="message-wrapper" :class="{ 'user-message': role === 'user' }">
    <!-- AIæ¶ˆæ¯æ°”æ³¡ -->
    <view v-if="role === 'assistant'" class="bubble assistant-bubble">
      <text class="bubble-content">{{ content }}</text>
      <text v-if="status === 'error'" class="error-indicator">âš ï¸</text>
      <view class="timestamp">{{ formatTime(timestamp) }}</view>
    </view>
    
    <!-- ç”¨æˆ·æ¶ˆæ¯æ°”æ³¡ -->
    <view v-else class="bubble user-bubble">
      <text class="bubble-content">{{ content }}</text>
      <view class="timestamp">{{ formatTime(timestamp) }}</view>
    </view>
  </view>
</template>

<script>
export default {
  name: 'MessageBubble',
  props: {
    content: {
      type: String,
      required: true
    },
    role: {
      type: String,
      default: 'assistant',
      validator: value => ['user', 'assistant'].includes(value)
    },
    status: {
      type: String,
      default: 'success'
    },
    timestamp: {
      type: Number,
      default: () => Date.now()
    }
  },
  methods: {
    formatTime(timestamp) {
      const date = new Date(timestamp)
      return date.toLocaleTimeString('zh-CN', {
        hour: '2-digit',
        minute: '2-digit'
      })
    }
  }
}
</script>

<style scoped lang="scss">
.message-wrapper {
  display: flex;
  margin-bottom: 10px;
  justify-content: flex-start;
  
  &.user-message {
    justify-content: flex-end;
  }
}

.bubble {
  max-width: 75%;
  padding: 12px 15px;
  border-radius: 18px;
  word-wrap: break-word;
  position: relative;
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

.assistant-bubble {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  border-bottom-left-radius: 4px;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.user-bubble {
  background: rgba(255, 255, 255, 0.9);
  color: #333;
  border-bottom-right-radius: 4px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.bubble-content {
  display: block;
  font-size: 15px;
  line-height: 1.5;
  margin-bottom: 5px;
}

.error-indicator {
  margin-left: 5px;
}

.timestamp {
  font-size: 11px;
  opacity: 0.6;
  text-align: right;
  margin-top: 5px;
}
</style>
```

#### **4.4.3 å½•éŸ³æŒ‰é’®ç»„ä»¶ - RecordButton.vue**

```vue
<template>
  <view class="record-button-container">
    <view 
      class="record-button"
      :class="{ 
        'recording': isRecording,
        'pulse': isRecording
      }"
      @touchstart="handleTouchStart"
      @touchend="handleTouchEnd"
      @touchmove="handleTouchMove"
    >
      <text v-if="!isRecording" class="icon">ğŸ¤</text>
      <text v-else class="icon rotating">â¸</text>
      <text v-if="isRecording" class="recording-time">{{ recordingTime }}s</text>
    </view>
    
    <!-- å½•éŸ³æç¤º -->
    <view v-if="isRecording" class="recording-tip">
      <text>æ¾å¼€åœæ­¢å½•éŸ³</text>
    </view>
  </view>
</template>

<script>
export default {
  name: 'RecordButton',
  props: {
    isRecording: {
      type: Boolean,
      default: false
    },
    recordingTime: {
      type: Number,
      default: 0
    }
  },
  emits: ['start', 'stop', 'cancel'],
  data() {
    return {
      touchStartY: 0,
      touchStartX: 0
    }
  },
  methods: {
    handleTouchStart(event) {
      if (!this.isRecording) {
        this.touchStartY = event.touches[0].clientY
        this.touchStartX = event.touches[0].clientX
        this.$emit('start')
      }
    },
    handleTouchEnd(event) {
      if (this.isRecording) {
        const currentY = event.changedTouches[0].clientY
        const currentX = event.changedTouches[0].clientX
        const moveDistance = this.touchStartY - currentY
        const horizontalDistance = Math.abs(this.touchStartX - currentX)
        
        // å‘ä¸Šæ»‘åŠ¨è¶…è¿‡50pxæˆ–æ­£å¸¸æ¾å¼€
        if (moveDistance > 50 || horizontalDistance < 20) {
          this.$emit('stop')
        } else {
          // æ¨ªå‘æ»‘åŠ¨è¶…è¿‡50pxåˆ™å–æ¶ˆ
          this.$emit('cancel')
        }
      }
    },
    handleTouchMove(event) {
      // å¯ä»¥åœ¨è¿™é‡Œæ›´æ–°UIæç¤ºç§»åŠ¨çŠ¶æ€
    }
  }
}
</script>

<style scoped lang="scss">
.record-button-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.record-button {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  
  &:active {
    transform: scale(0.95);
  }
  
  &.recording {
    background: linear-gradient(135deg, #ff6b6b 0%, #ff5252 100%);
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.5);
  }
  
  &.pulse {
    animation: pulse 1s infinite;
  }
}

@keyframes pulse {
  0%, 100% {
    box-shadow: 0 4px 15px rgba(255, 107, 107, 0.5);
  }
  50% {
    box-shadow: 0 4px 25px rgba(255, 107, 107, 0.8);
  }
}

.icon {
  font-size: 28px;
  display: block;
  
  &.rotating {
    animation: rotate 1s linear infinite;
  }
}

@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.recording-time {
  position: absolute;
  font-size: 12px;
  color: white;
  bottom: -20px;
  font-weight: bold;
}

.recording-tip {
  font-size: 12px;
  color: rgba(255, 255, 255, 0.7);
  text-align: center;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%, 100% {
    opacity: 0.7;
  }
  50% {
    opacity: 1;
  }
}
</style>
```

#### **4.4.4 è¾“å…¥æ¡†ç»„ä»¶ - InputBox.vue**

```vue
<template>
  <view class="input-box">
    <input
      v-model="inputValue"
      class="text-input"
      type="text"
      placeholder="è¾“å…¥æ–‡å­—æˆ–æŒ‰ä½å½•éŸ³..."
      :disabled="disabled"
      @input="emitInput"
      @confirm="handleSend"
    />
    <button 
      class="send-button"
      :disabled="!inputValue.trim() || disabled"
      @click="handleSend"
    >
      <text>å‘é€</text>
    </button>
  </view>
</template>

<script>
export default {
  name: 'InputBox',
  props: {
    value: {
      type: String,
      default: ''
    },
    disabled: {
      type: Boolean,
      default: false
    }
  },
  emits: ['input', 'send'],
  data() {
    return {
      inputValue: ''
    }
  },
  watch: {
    value(newVal) {
      this.inputValue = newVal
    }
  },
  methods: {
    emitInput() {
      this.$emit('input', this.inputValue)
    },
    handleSend() {
      if (this.inputValue.trim() && !this.disabled) {
        this.$emit('send')
      }
    }
  },
  mounted() {
    this.inputValue = this.value
  }
}
</script>

<style scoped lang="scss">
.input-box {
  display: flex;
  gap: 8px;
  align-items: center;
}

.text-input {
  flex: 1;
  padding: 10px 15px;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.3);
  background: rgba(255, 255, 255, 0.95);
  color: #333;
  font-size: 14px;
  outline: none;
  
  &:focus {
    border-color: rgba(255, 255, 255, 0.6);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
  }
  
  &:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
}

.send-button {
  padding: 10px 20px;
  border-radius: 20px;
  background: white;
  color: #667eea;
  border: none;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s;
  
  &:active:not(:disabled) {
    transform: scale(0.95);
  }
  
  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
}
</style>
```

#### **4.4.5 åŠ è½½ç»„ä»¶ - Loading.vue**

```vue
<template>
  <view class="loading-container">
    <view class="spinner">
      <view class="dot dot-1"></view>
      <view class="dot dot-2"></view>
      <view class="dot dot-3"></view>
    </view>
    <text class="loading-text">{{ text }}</text>
  </view>
</template>

<script>
export default {
  name: 'Loading',
  props: {
    text: {
      type: String,
      default: 'åŠ è½½ä¸­...'
    }
  }
}
</script>

<style scoped lang="scss">
.loading-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.spinner {
  display: flex;
  gap: 8px;
  align-items: center;
}

.dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: white;
  animation: bounce 1.4s infinite ease-in-out both;
  
  &.dot-1 {
    animation-delay: -0.32s;
  }
  
  &.dot-2 {
    animation-delay: -0.16s;
  }
}

@keyframes bounce {
  0%, 80%, 100% {
    transform: scale(0);
    opacity: 0.5;
  }
  40% {
    transform: scale(1);
    opacity: 1;
  }
}

.loading-text {
  color: white;
  font-size: 14px;
  opacity: 0.8;
}
</style>
```

### **4.5 å…¶ä»–é¡µé¢ç®€ä»‹**

#### **4.5.1 é¦–é¡µ - pages/index/index.vue**

```vue
<template>
  <view class="home-container">
    <view class="header">
      <text class="title">æ™ºèƒ½å¨ç”µåŠ©æ‰‹</text>
    </view>
    
    <scroll-view scroll-y class="content">
      <!-- å¿«é€Ÿæ“ä½œå¡ç‰‡ -->
      <view class="card-grid">
        <view 
          v-for="item in quickActions"
          :key="item.id"
          class="action-card"
          @click="navigateTo(item.path)"
        >
          <text class="card-icon">{{ item.icon }}</text>
          <text class="card-title">{{ item.title }}</text>
          <text class="card-desc">{{ item.desc }}</text>
        </view>
      </view>
      
      <!-- åŠŸèƒ½ä»‹ç» -->
      <view class="features-section">
        <text class="section-title">åŠŸèƒ½ç‰¹æ€§</text>
        <view v-for="feature in features" :key="feature.id" class="feature-item">
          <text class="feature-icon">{{ feature.icon }}</text>
          <text class="feature-text">{{ feature.text }}</text>
        </view>
      </view>
    </scroll-view>
  </view>
</template>

<script>
export default {
  name: 'HomePage',
  data() {
    return {
      quickActions: [
        {
          id: 1,
          title: 'è¯­éŸ³èŠå¤©',
          desc: 'ä¸AIäº¤äº’',
          icon: 'ğŸ’¬',
          path: '/pages/chat/chat'
        },
        {
          id: 2,
          title: 'å®¶ç”µæ§åˆ¶',
          desc: 'æ™ºèƒ½ç®¡ç†',
          icon: 'ğŸ ',
          path: '/pages/control/control'
        },
        {
          id: 3,
          title: 'æ™ºèƒ½åœºæ™¯',
          desc: 'ä¸€é”®å¯åŠ¨',
          icon: 'ğŸ¯',
          path: '/pages/scene/scene'
        },
        {
          id: 4,
          title: 'æˆ‘çš„è®¾ç½®',
          desc: 'ä¸ªäººä¸­å¿ƒ',
          icon: 'âš™ï¸',
          path: '/pages/mine/mine'
        }
      ],
      features: [
        { id: 1, icon: 'ğŸ¤', text: 'å®æ—¶è¯­éŸ³è¯†åˆ« - æ”¯æŒä¸­æ–‡å’Œæ–¹è¨€' },
        { id: 2, icon: 'ğŸ¤–', text: 'AIæ™ºèƒ½å¯¹è¯ - Moonshotå¤§æ¨¡å‹é©±åŠ¨' },
        { id: 3, icon: 'âš¡', text: 'å¿«é€Ÿå“åº” - ä½å»¶è¿Ÿè¯­éŸ³å¤„ç†' },
        { id: 4, icon: 'ğŸ”', text: 'æ•°æ®å®‰å…¨ - æœ¬åœ°åŠ å¯†å­˜å‚¨' }
      ]
    }
  },
  methods: {
    navigateTo(path) {
      uni.navigateTo({
        url: path
      })
    }
  }
}
</script>

<style scoped lang="scss">
.home-container {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

.header {
  padding: 40px 20px 30px;
  text-align: center;
  color: white;
}

.title {
  font-size: 28px;
  font-weight: bold;
}

.content {
  height: calc(100vh - 120px);
}

.card-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
  padding: 20px;
}

.action-card {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transition: all 0.3s;
  
  &:active {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
  }
}

.card-icon {
  font-size: 32px;
}

.card-title {
  font-size: 14px;
  font-weight: bold;
  color: #333;
}

.card-desc {
  font-size: 12px;
  color: #999;
}

.features-section {
  padding: 20px;
  margin-top: 20px;
}

.section-title {
  font-size: 18px;
  font-weight: bold;
  color: white;
  margin-bottom: 15px;
  display: block;
}

.feature-item {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
  padding: 12px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  color: white;
  backdrop-filter: blur(10px);
}

.feature-icon {
  font-size: 18px;
}

.feature-text {
  font-size: 14px;
}
</style>
```

---

## **ç¬¬äº”éƒ¨åˆ†ï¼šéƒ¨ç½²ä¸æ‰“åŒ…**

### **5.1 HBuilderXäº‘æ‰“åŒ…æµç¨‹ï¼ˆæ¨èï¼‰**

**ä¼˜åŠ¿ï¼š** æ— éœ€æœ¬åœ°é…ç½®Android SDKï¼Œç›´æ¥ä½¿ç”¨DCloudäº‘ç«¯æ‰“åŒ…æœåŠ¡

**æ­¥éª¤ï¼š**

**ç¬¬1æ­¥ï¼šè·å–DCloud AppID**
```
1. ç™»å½•DCloudå¼€å‘è€…ä¸­å¿ƒï¼šhttps://dev.dcloud.net.cn
2. åˆ›å»ºåº”ç”¨ï¼Œè·å–AppID
3. åœ¨manifest.jsonä¸­å¡«å†™AppID
```

**ç¬¬2æ­¥ï¼šé…ç½®æ‰“åŒ…å‚æ•°**
```
1. æ‰“å¼€HBuilderXé¡¹ç›®
2. ç‚¹å‡»èœå• â†’ å‘è¡Œ â†’ åŸç”ŸApp-äº‘æ‰“åŒ…
3. é€‰æ‹©Androidå¹³å°
4. å¡«å†™åº”ç”¨åŸºæœ¬ä¿¡æ¯ï¼š
   - åº”ç”¨åç§°ï¼šAIè¯­éŸ³åŠ©æ‰‹
   - åŒ…åï¼šcom.yourcompany.aivoiceassistant
   - ç‰ˆæœ¬å·ï¼š1.0.0
   - ç­¾åè¯ä¹¦ï¼ˆå¯åœ¨çº¿ç”Ÿæˆï¼‰
```

**ç¬¬3æ­¥ï¼šæ„å»ºAPK**
```
1. ç‚¹å‡»"æ‰“åŒ…"æŒ‰é’®
2. ç­‰å¾…äº‘ç«¯ç¼–è¯‘å®Œæˆï¼ˆé€šå¸¸éœ€è¦2-5åˆ†é’Ÿï¼‰
3. ä¸‹è½½ç”Ÿæˆçš„APKæ–‡ä»¶
```


---

## **ç¬¬å…­éƒ¨åˆ†ï¼šAPIå¯†é’¥é…ç½®**

### **6.1 ç™¾åº¦è¯­éŸ³APIå¯†é’¥è·å–**

```
1. è®¿é—®ç™¾åº¦AIå¼€æ”¾å¹³å°ï¼šhttps://ai.baidu.com
2. æ³¨å†Œè´¦æˆ·å¹¶ç™»å½•
3. åˆ›å»ºåº”ç”¨è·å–API Keyå’ŒSecret Key
4. åœ¨state/index.jsä¸­é…ç½®ï¼š

apiConfig: {
  baiduApiKey: 'YOUR_BAIDU_API_KEY',
  baiduSecretKey: 'YOUR_BAIDU_SECRET_KEY'
}
```

### **6.2 Moonshot APIå¯†é’¥è·å–**

```
1. è®¿é—®Moonshotå¼€æ”¾å¹³å°ï¼šhttps://platform.moonshot.cn
2. æ³¨å†Œè´¦æˆ·å¹¶ç™»å½•
3. åœ¨æ§åˆ¶å°åˆ›å»ºAPIå¯†é’¥
4. åœ¨state/index.jsä¸­é…ç½®ï¼š

apiConfig: {
  moonshotApiKey: 'YOUR_MOONSHOT_API_KEY'
}
```

### **6.3 ç¯å¢ƒå˜é‡é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰**

åˆ›å»º `.env.production` æ–‡ä»¶ï¼š

```
VUE_APP_BAIDU_API_KEY=your_baidu_api_key
VUE_APP_BAIDU_SECRET_KEY=your_baidu_secret_key
VUE_APP_MOONSHOT_API_KEY=your_moonshot_api_key
```

åœ¨main.jsä¸­ä½¿ç”¨ï¼š

```javascript
store.state.apiConfig = {
  baiduApiKey: process.env.VUE_APP_BAIDU_API_KEY,
  baiduSecretKey: process.env.VUE_APP_BAIDU_SECRET_KEY,
  moonshotApiKey: process.env.VUE_APP_MOONSHOT_API_KEY
}
```

---

## **ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ**

### **7.1 æ€§èƒ½ä¼˜åŒ–**

**ç»„ä»¶æ‡’åŠ è½½ï¼š**
```javascript
// ä½¿ç”¨åŠ¨æ€import
const ChatPage = () => import('@/pages/chat/chat.vue')
const ControlPage = () => import('@/pages/control/control.vue')
```

**æ¶ˆæ¯åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼š** å½“æ¶ˆæ¯æ•°è¶…è¿‡100æ¡æ—¶ï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ä¼˜åŒ–

**APIè¯·æ±‚è¶…æ—¶æ§åˆ¶ï¼š**
```javascript
// è®¾ç½®è¯·æ±‚è¶…æ—¶
uni.request({
  url: apiUrl,
  timeout: 10000, // 10ç§’è¶…æ—¶
  // ...
})
```

**å†…å­˜ç®¡ç†ï¼š**
```javascript
// å®šæœŸæ¸…ç†æ—§æ¶ˆæ¯
if (this.messages.length > 500) {
  this.messages = this.messages.slice(-500)
}
```

### **7.2 é”™è¯¯å¤„ç†æœ€ä½³å®è·µ**

```javascript
// ç»Ÿä¸€é”™è¯¯å¤„ç†
try {
  const result = await apiCall()
  if (!result.success) {
    throw new Error(result.error)
  }
} catch (error) {
  console.error('ä¸šåŠ¡é”™è¯¯:', error)
  uni.showToast({
    title: 'æ“ä½œå¤±è´¥: ' + error.message,
    icon: 'none'
  })
}
```

### **7.3 å®‰å…¨å»ºè®®**

- **ä¸åœ¨ä»£ç ä¸­ç¡¬ç¼–ç APIå¯†é’¥** - ä½¿ç”¨ç¯å¢ƒå˜é‡
- **ä½¿ç”¨HTTPSåŠ å¯†é€šä¿¡** - æ‰€æœ‰APIè°ƒç”¨éƒ½ä½¿ç”¨https
- **éªŒè¯ç”¨æˆ·æƒé™** - åœ¨å½•éŸ³å‰æ£€æŸ¥æƒé™
- **æ¸…ç†æ•æ„Ÿæ•°æ®** - åˆ é™¤ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
- **é€Ÿç‡é™åˆ¶** - é˜²æ­¢APIæ»¥ç”¨

---

## **ç¬¬å…«éƒ¨åˆ†ï¼šæ•…éšœæ’æŸ¥**

### **8.1 å¸¸è§é—®é¢˜**

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|-----|--------|
| å½•éŸ³æŒ‰é’®æ— ååº” | æ£€æŸ¥Androidæƒé™é…ç½®ã€é‡å¯åº”ç”¨ |
| è¯†åˆ«ç»“æœä¸ºç©º | éªŒè¯ç™¾åº¦APIå¯†é’¥ã€æ£€æŸ¥ç½‘ç»œè¿æ¥ |
| AIå›å¤è¶…æ—¶ | æ£€æŸ¥Moonshot APIå¯†é’¥ã€å¢åŠ è¶…æ—¶æ—¶é—´ |
| APKå®‰è£…å¤±è´¥ | æ£€æŸ¥ç­¾åè¯ä¹¦ã€æ¸…ç©ºæ—§ç‰ˆæœ¬ |
| å†…å­˜å ç”¨è¿‡é«˜ | å‡å°‘ä¿ç•™æ¶ˆæ¯æ•°ã€é‡Šæ”¾ä¸´æ—¶èµ„æº |

### **8.2 è°ƒè¯•æŠ€å·§**

```javascript
// å¼€å¯è¯¦ç»†æ—¥å¿—
// logger.js
class Logger {
  log(tag, message) {
    console.log(`[${tag}] ${message}`)
  }
  
  error(tag, error) {
    console.error(`[${tag}] ${error}`)
  }
}

export default new Logger()
```

---

## **ç¬¬ä¹éƒ¨åˆ†ï¼šæ€»ç»“ä¸å±•æœ›**

### **10.1 é¡¹ç›®å®Œæˆåº¦**

âœ… **å·²å®ç°åŠŸèƒ½ï¼š**
- å®Œæ•´çš„5é¡µé¢åº”ç”¨æ¶æ„
- è¯­éŸ³å½•å…¥ä¸è½¬æ–‡å­—
- AIæ™ºèƒ½å¯¹è¯
- æ¶ˆæ¯å±•ç¤ºä¸æ»šåŠ¨
- APKæ‰“åŒ…éƒ¨ç½²

âœ… **æŠ€æœ¯ç‰¹ç‚¹ï¼š**
- è½»é‡çº§æ¡†æ¶é€‰æ‹©
- å¿«é€Ÿå¼€å‘è¿­ä»£
- è·¨å¹³å°å…¼å®¹æ€§
- ç”Ÿäº§çº§ä»£ç è´¨é‡

### **10.2 åç»­ä¼˜åŒ–æ–¹å‘**

- ğŸš€ æ·»åŠ è¯­éŸ³åˆæˆï¼ˆæ–‡å­—è½¬è¯­éŸ³ï¼‰
- ğŸ¯ é›†æˆæ›´å¤šå®¶ç”µåè®®ï¼ˆWiFiã€Zigbeeï¼‰
- ğŸ“Š æ•°æ®åˆ†æä¸ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
- ğŸ”” æ¨é€é€šçŸ¥åŠŸèƒ½
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ

### **10.3 æŠ€æœ¯æ ˆå‡çº§å»ºè®®**

- è€ƒè™‘ä½¿ç”¨ **Vue 3 + TypeScript** æå‡ä»£ç è´¨é‡
- é›†æˆ **TensorFlow.js** è¿›è¡Œæœ¬åœ°è¯­éŸ³å¤„ç†
- ä½¿ç”¨ **WebSocket** å®ç°å®æ—¶é€šä¿¡
- å¼•å…¥ **GraphQL** ä¼˜åŒ–APIæŸ¥è¯¢

---

## **é™„å½•ï¼šå®Œæ•´æ–‡ä»¶æ¸…å•**

```
âœ“ manifest.json - åº”ç”¨é…ç½®
âœ“ main.js - å…¥å£æ–‡ä»¶
âœ“ App.vue - æ ¹ç»„ä»¶
âœ“ package.json - ä¾èµ–é…ç½®
âœ“ store/index.js - çŠ¶æ€ç®¡ç†
âœ“ utils/audio.js - éŸ³é¢‘å¤„ç†
âœ“ utils/baidu-speech.js - ç™¾åº¦API
âœ“ utils/moonshot-api.js - Moonshot API
âœ“ components/MessageBubble.vue - æ¶ˆæ¯ç»„ä»¶
âœ“ components/RecordButton.vue - å½•éŸ³ç»„ä»¶
âœ“ components/InputBox.vue - è¾“å…¥ç»„ä»¶
âœ“ components/Loading.vue - åŠ è½½ç»„ä»¶
âœ“ pages/index/index.vue - é¦–é¡µ
âœ“ pages/chat/chat.vue - èŠå¤©é¡µ
âœ“ pages/control/control.vue - æ§åˆ¶é¡µ
âœ“ pages/scene/scene.vue - åœºæ™¯é¡µ
âœ“ pages/mine/mine.vue - æˆ‘çš„é¡µ
```

---

**æ–‡æ¡£å®Œæˆï¼** è¿™ä»½PRDåŒ…å«äº†ä»é¡¹ç›®è§„åˆ’ã€æŠ€æœ¯æ¶æ„ã€ä»£ç å®ç°åˆ°éƒ¨ç½²å‘å¸ƒçš„å…¨å¥—å†…å®¹ã€‚

